{{template "base/header.tmpl" .}}
{{template "base/navbar.tmpl" .}}

<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" id="prism-light" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" id="prism-dark" disabled />

<style>
    .code-container {
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid var(--bs-border-color);
    }
    pre {
        margin-bottom: 0 !important;
        border-radius: 0 !important;
        background-color: var(--bs-body-tertiary-bg) !important;
    }
    code {
        font-family: 'Fira Code', 'Consolas', monospace;
        font-size: 0.9rem;
    }
    .file-header {
        background-color: var(--bs-body-tertiary-bg);
        border-bottom: 1px solid var(--bs-border-color);
    }
</style>

<div class="container py-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb py-2 px-3 bg-body-tertiary rounded border shadow-sm">
            <li class="breadcrumb-item">
                <a href="/view/{{$.Owner}}/{{$.RepoName}}/{{$.CurrentBranch}}/" class="fw-bold text-decoration-none text-primary">
                    {{$.RepoName}}
                </a>
            </li>
            {{range .Breadcrumbs}}
            <li class="breadcrumb-item">
                <a href="/view/{{$.Owner}}/{{$.RepoName}}/{{$.CurrentBranch}}/{{.Path}}" class="text-decoration-none">
                    {{.Name}}
                </a>
            </li>
            {{end}}
        </ol>
    </nav>

    <div class="card shadow-sm code-container">
        <div class="file-header p-3 d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
                <span class="me-2">ðŸ“„</span>
                <strong class="text-body">{{.FileName}}</strong>
                <span class="ms-3 text-body-secondary small border-start ps-3">
                    {{len .Content}} bytes
                </span>
            </div>
            <div class="btn-group">
                <button class="btn btn-sm btn-outline-secondary" onclick="copyToClipboard()">Copy</button>
                <a href="?raw=true" class="btn btn-sm btn-outline-secondary">Raw</a>
            </div>
        </div>

        <div class="card-body p-0">
            <pre class="line-numbers"><code class="language-{{if .Extension}}{{.Extension}}{{else}}clike{{end}}">{{.Content}}</code></pre>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

<script>
    // Logic to swap Prism themes based on Bootstrap theme
    const updatePrismTheme = () => {
        const isDark = document.documentElement.getAttribute('data-bs-theme') === 'dark';
        document.getElementById('prism-dark').disabled = !isDark;
        document.getElementById('prism-light').disabled = isDark;
    };

    // Observe theme changes
    const observer = new MutationObserver(updatePrismTheme);
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['data-bs-theme'] });
    updatePrismTheme();

    function copyToClipboard() {
        const code = document.querySelector('code').innerText;
        navigator.clipboard.writeText(code).then(() => {
            alert('Code copied to clipboard!');
        });
    }
</script>

{{template "base/footer.tmpl" .}}